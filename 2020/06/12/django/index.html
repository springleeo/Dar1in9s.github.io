<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Django基础语法"><meta name="keywords" content="django"><meta name="author" content="Dar1in9"><meta name="copyright" content="Dar1in9"><title>Django基础语法 | Dar1in9's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="http://ta.qq.com"><script>(function() {
   var hm = document.createElement("script");
   hm.src = "https://tajs.qq.com/stats?sId=&lt;script type=&quot;text/javascript&quot; src=&quot;http://tajs.qq.com/stats?sId=66549793&quot; charset=&quot;UTF-8&quot;&gt;&lt;/script&gt;";
   var s = document.getElementsByTagName("script")[0];
   s.parentNode.insertBefore(hm, s);
 })();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"MY1GAADR9W","apiKey":"5032629da4e94f659d98a4052bc1c5cd","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#django项目的创建"><span class="toc-number">1.</span> <span class="toc-text">django项目的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#新建项目"><span class="toc-number">1.1.</span> <span class="toc-text">新建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动开发服务器"><span class="toc-number">1.2.</span> <span class="toc-text">启动开发服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建app"><span class="toc-number">1.3.</span> <span class="toc-text">创建app</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模型"><span class="toc-number">2.</span> <span class="toc-text">模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本设置"><span class="toc-number">2.1.</span> <span class="toc-text">基本设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型的创建和迁移（激活）"><span class="toc-number">2.2.</span> <span class="toc-text">模型的创建和迁移（激活）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建模型"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模型迁移（激活）"><span class="toc-number">2.2.2.</span> <span class="toc-text">模型迁移（激活）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#增加数据"><span class="toc-number">2.3.</span> <span class="toc-text">增加数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询数据"><span class="toc-number">2.4.</span> <span class="toc-text">查询数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Q对象进行复杂查询"><span class="toc-number">2.4.1.</span> <span class="toc-text">使用Q对象进行复杂查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改-更新-数据"><span class="toc-number">2.5.</span> <span class="toc-text">修改(更新)数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除数据"><span class="toc-number">2.6.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他有用的QuerySets的API"><span class="toc-number">2.7.</span> <span class="toc-text">其他有用的QuerySets的API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#视图"><span class="toc-number">3.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#URL路由"><span class="toc-number">3.1.</span> <span class="toc-text">URL路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单实例"><span class="toc-number">3.1.1.</span> <span class="toc-text">简单实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path转换器"><span class="toc-number">3.1.2.</span> <span class="toc-text">path转换器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用正则表达式"><span class="toc-number">3.1.3.</span> <span class="toc-text">使用正则表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指定视图参数的默认值"><span class="toc-number">3.1.4.</span> <span class="toc-text">指定视图参数的默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义错误页面"><span class="toc-number">3.1.5.</span> <span class="toc-text">自定义错误页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由转发"><span class="toc-number">3.2.</span> <span class="toc-text">路由转发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反向解析"><span class="toc-number">3.3.</span> <span class="toc-text">反向解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图函数"><span class="toc-number">3.4.</span> <span class="toc-text">视图函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django内置的一些方法"><span class="toc-number">3.5.</span> <span class="toc-text">Django内置的一些方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#render"><span class="toc-number">3.5.1.</span> <span class="toc-text">render()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redirect"><span class="toc-number">3.5.2.</span> <span class="toc-text">redirect()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-object-or-404"><span class="toc-number">3.5.3.</span> <span class="toc-text">get_object_or_404()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpRequest对象"><span class="toc-number">3.6.</span> <span class="toc-text">HttpRequest对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用属性"><span class="toc-number">3.6.1.</span> <span class="toc-text">常用属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#QueryDict对象"><span class="toc-number">3.7.</span> <span class="toc-text">QueryDict对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法"><span class="toc-number">3.7.1.</span> <span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#django-sessioin"><span class="toc-number">3.8.</span> <span class="toc-text">django sessioin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#启用session"><span class="toc-number">3.8.1.</span> <span class="toc-text">启用session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sessioin的配置"><span class="toc-number">3.8.2.</span> <span class="toc-text">sessioin的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session的基本操作"><span class="toc-number">3.8.3.</span> <span class="toc-text">session的基本操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态文件"><span class="toc-number">3.9.</span> <span class="toc-text">静态文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模板"><span class="toc-number">4.</span> <span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#循环for，条件判断if"><span class="toc-number">4.1.</span> <span class="toc-text">循环for，条件判断if</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://blog-1300147235.cos.ap-chengdu.myqcloud.com/kakashi-cat.jpg"></div><div class="author-info__name text-center">Dar1in9</div><div class="author-info__description text-center">人间值得，未来可期</div><div class="follow-button"><a href="https://github.com/Dar1in9s" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">58</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">21</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://blog-1300147235.cos.ap-chengdu.myqcloud.com/Background2.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Dar1in9's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Django基础语法</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-06-12</time><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">6.7k</span><span class="post-meta__separator">|</span><span>阅读时长: 24 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>趁着一个项目学了学django框架，总的感觉是大而全，只接触到皮毛，慢慢学习吧。</p>
<a id="more"></a>

<h1 id="django项目的创建"><a href="#django项目的创建" class="headerlink" title="django项目的创建"></a>django项目的创建</h1><h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><p>新建一个django项目:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject django_project</span><br></pre></td></tr></table></figure>
<p>运行成功后会有如下目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">django_project</span><br><span class="line">├── manage.py</span><br><span class="line">├── django_project</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── asgi.py</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.py</span><br></pre></td></tr></table></figure>
<p>我们会发现执行命令后，新建了一个 <code>django_project</code> 目录，其中还有一个 <code>django_project</code> 目录</p>
<ul>
<li><code>django_project</code>: 项目的容器。</li>
<li><code>manage.py</code>: 一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。</li>
<li><code>__init__.py</code>: 一个空文件，告诉 Python 该目录是一个 Python 包。</li>
<li><code>asgi.py</code>: 一个 ASGI 兼容的 Web 服务器的入口，以便运行你的项目。</li>
<li><code>settings.py</code>: 该 Django 项目的设置/配置。</li>
<li><code>urls.py</code>: 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站”目录”。</li>
<li><code>wsgi.py</code>: 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。</li>
</ul>
<h2 id="启动开发服务器"><a href="#启动开发服务器" class="headerlink" title="启动开发服务器"></a>启动开发服务器</h2><p>可以运行<code>python manage.py runserver 0.0.0.0:8000</code>命令来启动django项目</p>
<h2 id="创建app"><a href="#创建app" class="headerlink" title="创建app"></a>创建app</h2><p>在 Django 中，每一个应用（app）都是一个 Python 包，并且遵循着相同的约定。Django 自带一个工具，可以帮你生成应用的基础目录结构。</p>
<p>app应用与project项目的区别：</p>
<ul>
<li>一个app实现某个功能，比如博客、公共档案数据库或者简单的投票系统；</li>
<li>一个project是配置文件和多个app的集合，这些app组合成整个站点；</li>
<li>一个project可以包含多个app；</li>
<li>一个app可以属于多个project！</li>
<li>app的存放位置可以是任何地点，但是通常都将它们放在与manage.py脚本同级的目录下，这样方便导入文件。</li>
</ul>
<p>进入mysite项目根目录，输入下述命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python manage.py startapp app</span></span><br></pre></td></tr></table></figure>
<p>系统会自动生成 app应用的目录，其结构如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app/</span><br><span class="line">├── __init__.py</span><br><span class="line">├── admin.py</span><br><span class="line">├── apps.py</span><br><span class="line">├── models.py</span><br><span class="line">├── tests.py</span><br><span class="line">├── views.py</span><br><span class="line">├── migrations/</span><br><span class="line">    └── __init__.py</span><br></pre></td></tr></table></figure>

<p>创建了之后还需要将app添加到<code>setting.py</code>中<code>INSTALLED_APPS</code>列表中，使得 django 能自动找到app中的模板文件(<code>app-name/templates/</code>下的文件)和静态文件(<code>app-name/static/</code>中的文件) </p>
<h1 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h1><h2 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h2><p>安装mysql驱动 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mysqlclient</span><br></pre></td></tr></table></figure>
<p>修改<code>setting.py</code>配置</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>, <span class="comment"># 数据库引擎</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django_mysql'</span>, <span class="comment"># 数据库名</span></span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,         <span class="comment"># 账号</span></span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'root'</span>,     <span class="comment"># 密码</span></span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,    <span class="comment"># HOST</span></span><br><span class="line">        <span class="string">'POST'</span>: <span class="number">3306</span>,           <span class="comment"># 端口</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模型的创建和迁移（激活）"><a href="#模型的创建和迁移（激活）" class="headerlink" title="模型的创建和迁移（激活）"></a>模型的创建和迁移（激活）</h2><p>模型类需要定义在app下的<code>modules.py</code>中，一个数据表对应一个模型类，表中的字段对应模型中的类属性。</p>
<h3 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h3><p>模型类需要继承自<code>django.db.modules.Module</code>类</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> modules</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<p>上面的代码相当于SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> app_users (</span><br><span class="line">    <span class="string">"id"</span> <span class="built_in">serial</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="string">"username"</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">"password"</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>其中，表名<code>app_users</code>由Django自动生成，默认格式为“<strong>项目名称+下划线+小写类名</strong>”，Django默认自动创建自增主键<code>id</code>，当然，你也可以自己指定主键。<br>可以通过在模型类中定义元数据类，自定义表名</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> modules</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    username = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">'users'</span></span><br></pre></td></tr></table></figure>

<p>常用字段类型</p>
<ul>
<li><code>AutoField</code>  一个自动增加的整数类型字段</li>
<li><code>BooleanField</code> 布尔值类型。默认值是<code>None</code>。</li>
<li><code>CharField</code>    字符串类型。必须接收一个<code>max_length</code>参数，表示字符串长度不能超过该值</li>
<li><code>DateField</code>    日期类型。一个Python中的<code>datetime.date</code>的实例。</li>
<li><code>EmailField</code>    邮箱类型，默认<code>max_length</code>最大长度254位。</li>
<li><code>FileField</code>    上传文件类型</li>
<li><code>ImageField</code>    图像类型，后面单独介绍</li>
<li><code>IntegerField</code>    整数类型，最常用的字段之一。取值范围-2147483648到2147483647。</li>
<li><code>TextField</code>    大量文本内容</li>
<li><code>UUIDField</code>    用于保存通用唯一识别码的字段。使用Python的<code>UUID</code>类。</li>
</ul>
<h3 id="模型迁移（激活）"><a href="#模型迁移（激活）" class="headerlink" title="模型迁移（激活）"></a>模型迁移（激活）</h3><p>完成模型创建后，执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 制作迁移</span></span><br><span class="line">python manage.py makemigrations</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成迁移</span></span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<h2 id="增加数据"><a href="#增加数据" class="headerlink" title="增加数据"></a>增加数据</h2><p>新建一个模型对象的方法有如下几种：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.create(username=<span class="string">'admin'</span>, password=<span class="string">'pwd'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = User(username=<span class="string">'admin'</span>, password=<span class="string">'pwd'</span>)</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = User()</span><br><span class="line">user.name = <span class="string">'admin'</span></span><br><span class="line">user.password = <span class="string">'pwd'</span></span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.boject.get_or_create(username=<span class="string">'admin'</span>, password=<span class="string">'pwd'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>查询对象有以下方法</p>
<ul>
<li><p>获取所有数据</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.all()</span><br></pre></td></tr></table></figure></li>
<li><p>切片操作</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取5个人，不支持负索引，切片可以节约内存</span></span><br><span class="line">User.objects.all()[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>获取满足条件的一个对象,如果有多条会报错</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.get(username=<span class="string">'admin'</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>filter</code>进行条件查询</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询username字段严格等于'admin'的所有对象</span></span><br><span class="line">User.objects.filter(username=<span class="string">'amdin'</span>)  </span><br><span class="line">User.objects.filter(username__iexact=<span class="string">'admin'</span>)  <span class="comment">#不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询username中包含admin的所有对象</span></span><br><span class="line">User.objects.filter(username__contains=<span class="string">'admin'</span>)</span><br><span class="line">User.objects.filter(username__icontains=<span class="string">'admin'</span>)  <span class="comment"># 不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询username中以'admin'开头的</span></span><br><span class="line">User.objects.filter(username__startwith=<span class="string">'admin'</span>)</span><br><span class="line">User.objects.filter(username__istartwith=<span class="string">'admin'</span>)  <span class="comment"># 不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询username中以'admin'结尾的</span></span><br><span class="line">User.objects.filter(username__endwith=<span class="string">'admin'</span>)</span><br><span class="line">User.objects.filter(username__iendwith=<span class="string">'admin'</span>)  <span class="comment"># 不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则表达式查询</span></span><br><span class="line">User.objects.filter(name__regex=<span class="string">'^admin'</span>)</span><br><span class="line">User.objects.filter(name__iregex=<span class="string">'^admin'</span>)  <span class="comment"># 不区分大小写</span></span><br></pre></td></tr></table></figure>
<p>除此之外，还有<br><code>__gt</code> 大于<br><code>__gte</code> 大于等于<br><code>__lt</code> 小于<br><code>__lte</code> 小于等于<br><code>__in</code> 存在于一个<code>list</code>范围内</p>
</li>
<li><p>使用<code>exclude</code>排除符合条件的</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 排除包含 admin 的User对象</span></span><br><span class="line">User.objects.exclude(username__contains=<span class="string">"admin"</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>链式过滤<br><code>filter</code>和<code>exclude</code>的结果依然是个<code>QuerySet</code>，因此它可以继续被<code>filter</code>和<code>exclude</code>，这就形成了链式过滤：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.objects.filter(username=<span class="string">'admin'</span>).filter(password=<span class="string">'password'</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="使用Q对象进行复杂查询"><a href="#使用Q对象进行复杂查询" class="headerlink" title="使用Q对象进行复杂查询"></a>使用Q对象进行复杂查询</h3><p>普通<code>filter</code>函数里的条件都是“<code>and</code>”逻辑，如果你想实现“<code>or</code>”逻辑就需要使用Q对象<br>Q来自<code>django.db.models.Q</code>，用于封装关键字参数的集合，可以作为关键字参数用于<code>filter</code>、<code>exclude</code>和<code>get</code>等函数<br>可以使用<code>&amp;</code>或者<code>|</code>或<code>~</code>来组合Q对象，分别表示与或非逻辑。它将返回一个新的Q对象。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Q(question__startswith=<span class="string">'Who'</span>)|Q(question__startswith=<span class="string">'What'</span>)</span><br><span class="line"><span class="comment"># 这相当于：</span></span><br><span class="line">WHERE question LIKE <span class="string">'Who%'</span> OR question LIKE <span class="string">'What%'</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，以逗号分隔的都表示AND关系：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">Q(question__startswith=<span class="string">'Who'</span>),</span><br><span class="line">Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">2</span>)) | Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line">)</span><br><span class="line"><span class="comment"># 它相当于</span></span><br><span class="line"><span class="comment"># SELECT * from polls WHERE question LIKE 'Who%'</span></span><br><span class="line">AND (pub_date = <span class="string">'2005-05-02'</span> OR pub_date = <span class="string">'2005-05-06'</span>)</span><br></pre></td></tr></table></figure>

<p>当关键字参数和Q对象组合使用时，Q对象必须放在前面，如下例子：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">2</span>)) | Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">6</span>)),question__startswith=<span class="string">'Who'</span>,)</span><br></pre></td></tr></table></figure>
<p>如果关键字参数放在Q对象的前面，则会报错</p>
<h2 id="修改-更新-数据"><a href="#修改-更新-数据" class="headerlink" title="修改(更新)数据"></a>修改(更新)数据</h2><p>使用<code>update()</code>方法可以批量为<code>QuerySet</code>中所有的对象进行更新操作。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新所有用户名为admin的密码为new_pwd</span></span><br><span class="line">User.objects.filter(username=<span class="string">'admin'</span>).update(password=<span class="string">'new_pwd'</span>)</span><br></pre></td></tr></table></figure>
<p><code>update</code>方法会被立刻执行，并返回操作匹配到的行的数目</p>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>删除对象使用的是对象的<code>delete()</code>方法。该方法将返回被删除对象的总数量和一个字典，字典包含了每种被删除对象的类型和该类型的数量</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除所有用户名为admin的对象</span></span><br><span class="line">User.objects.filter(username=<span class="string">'admin'</span>).delete()</span><br></pre></td></tr></table></figure>

<h2 id="其他有用的QuerySets的API"><a href="#其他有用的QuerySets的API" class="headerlink" title="其他有用的QuerySets的API"></a>其他有用的QuerySets的API</h2><p><code>order_by()</code>  对查询集进行排序</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 结果将按照id降序排序，然后再按照score升序排序。</span></span><br><span class="line"><span class="comment"># "-id"前面的负号表示降序顺序。 升序是默认的。 要随机排序，使用"?"</span></span><br><span class="line">User.objects.filter(username=<span class="string">'admin'</span>).order_by(<span class="string">'-id'</span>, <span class="string">'score'</span>) </span><br><span class="line"></span><br><span class="line">User.objects.filter(username=<span class="string">'admin'</span>).order_by(<span class="string">'?'</span>)</span><br></pre></td></tr></table></figure>
<p><code>reverse()</code> 反向排序<br><code>distinct()</code> 对查询集去重<br><code>values()</code> 返回一个包含数据的字典的<code>queryset</code>，而不是模型实例<br>每个字典表示一个对象，键对应于模型对象的属性名称。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表中包含的是Blog对象</span></span><br><span class="line">User.objects.filter(name__startswith=<span class="string">'Beatles'</span>)</span><br><span class="line"><span class="comment"># =&gt; &lt;QuerySet [&lt;Blog: Beatles Blog&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表中包含的是数据字典</span></span><br><span class="line">Blog.objects.filter(name__startswith=<span class="string">'Beatles'</span>).values()</span><br><span class="line"><span class="comment"># =&gt; &lt;QuerySet [&#123;'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'&#125;]&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><p>视图层是Django处理请求的核心代码层，我们大多数Python代码都集中在这一层面。</p>
<p>它对外接收用户请求，对内调度模型层和模版层，统合数据库和前端，最后根据业务逻辑，将处理好的数据，与前端结合，返回给用户。</p>
<h2 id="URL路由"><a href="#URL路由" class="headerlink" title="URL路由"></a>URL路由</h2><p>URL是Web服务的入口，用户通过浏览器发送过来的任何请求，都是发送到一个指定的URL地址，然后被响应。</p>
<p>在Django项目中编写路由，就是向外暴露我们接收哪些URL的请求，除此之外的任何URL都不被处理，也没有返回。通俗地理解，不恰当的形容，URL路由是你的Web服务对外暴露的API。</p>
<p>URL路由在Django项目中的体现就是<code>urls.py</code>文件，这个文件可以有很多个，但绝对不会在同一目录下。实际上Django提倡项目有个根<code>urls.py</code>，各app下分别有自己的一个<code>urls.py</code>，既集中又分治，是一种解耦的模式。</p>
<p>根 URL 就是在创建项目时自动创建的<code>urls.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>默认导入了<code>path</code>方法和<code>admin</code>模块，然后有一条指向<code>admin</code>后台的url路径。</p>
<p>我们自己要编写的url路由，基本也是这个套路。</p>
<p>Django处理请求的流程</p>
<ol>
<li>决定要使用的根<code>URLconf</code>模块。通常，这是<code>ROOT_URLCONF</code>设置的值，但是如果传入的<code>HttpRequest</code>对象具有<code>urlconf</code>属性（由中间件设置），则其值将被用于代替<code>ROOT_URLCONF</code>设置。通俗的讲，就是你可以自定义项目入口url是哪个文件！</li>
<li>加载该模块并寻找可用的<code>urlpatterns</code>。 它是<code>django.urls.path()</code>或者<code>django.urls.re_path()</code>实例的一个列表。</li>
<li>依次匹配每个URL模式，在与请求的URL相匹配的第一个模式停下来。也就是说，url匹配是从上往下的短路操作，所以url在列表中的位置非常关键。</li>
<li>导入并调用匹配行中给定的视图，该视图是一个简单的Python函数（被称为视图函数）,或基于类的视图。 视图将获得如下参数:<ul>
<li>一个<code>HttpRequest</code> 实例。</li>
<li>如果匹配的表达式返回了未命名的组，那么匹配的内容将作为位置参数提供给视图。</li>
<li>关键字参数由表达式匹配的命名组组成，但是可以被<code>django.urls.path()</code>的可选参数<code>kwargs</code>覆盖。</li>
</ul>
</li>
<li>如果没有匹配到任何表达式，或者过程中抛出异常，将调用一个适当的错误处理视图。</li>
</ol>
<h3 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index),</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/'</span>, views.year_archive),</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/&lt;int:month&gt;/'</span>, views.month_archive),</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/&lt;int:month&gt;/&lt;slug:slug&gt;/'</span>, views.article_detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>要捕获一段url中的值，需要使用尖括号</li>
<li>可以转换捕获到的值为指定类型，比如例子中的<code>int</code>。<br>默认情况下，捕获到的结果保存为字符串类型，不包含<code>/</code>这个特殊字符；</li>
<li>匹配模式的最开头不需要添加<code>/</code>，因为默认情况下，每个url都带一个最前面的<code>/</code>，既然大家都有的部分，就不用浪费时间特别写一个了。</li>
</ul>
<p>每当<code>urls.py</code>文件被第一次加载的时候，<code>urlpatterns</code>里的表达式们都将被预先编译，这会大大提高系统处理路由的速度。</p>
<h3 id="path转换器"><a href="#path转换器" class="headerlink" title="path转换器"></a>path转换器</h3><p>默认情况下，Django内置下面的路径转换器：</p>
<ul>
<li><code>str</code>：匹配任何非空字符串，但不含斜杠<code>/</code>，如果你没有专门指定转换器，那么这个是默认使用的</li>
<li><code>int</code>：匹配0和正整数，返回一个<code>int</code>类型</li>
<li><code>slug</code>：可理解为注释、后缀、附属等概念，是url拖在最后的一部分解释性字符。该转换器匹配任何<code>ASCII</code>字符以及连接符和下划线，比如<code>building-your-1st-django-site</code></li>
<li><code>uuid</code>：匹配一个<code>uuid</code>格式的对象。为了防止冲突，规定必须使用破折号，所有字母必须小写，例如<code>075194d3-6885-417e-a8a8-6c931e272f00</code>。返回一个<code>UUID</code>对象</li>
<li><code>path</code>：匹配任何非空字符串，重点是可以包含路径分隔符<code>/</code>。这个转换器可以帮助你匹配整个url而不是一段一段的url字符串。</li>
</ul>
<h3 id="使用正则表达式"><a href="#使用正则表达式" class="headerlink" title="使用正则表达式"></a>使用正则表达式</h3><p>使用<code>re_path()</code>方法来进行基于正则的url匹配</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'articles/2003/'</span>, views.special_case_2003),</span><br><span class="line">    re_path(<span class="string">r'^articles/(?P&lt;year&gt;[0-9]&#123;4&#125;)/$'</span>, views.year_archive),</span><br><span class="line">    re_path(<span class="string">r'^articles/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/$'</span>, views.month_archive),</span><br><span class="line">    re_path(<span class="string">r'^articles/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/(?P&lt;slug&gt;[\w-]+)/$'</span>, views.article_detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>与path()方法不同的在于两点：</p>
<ul>
<li><code>year</code>中匹配不到10000等非四位数字，这是正则表达式决定的</li>
<li>传递给视图的所有参数都是<strong>字符串类型</strong>。而不像<code>path()</code>方法中可以指定转换成某种类型。</li>
</ul>
<h3 id="指定视图参数的默认值"><a href="#指定视图参数的默认值" class="headerlink" title="指定视图参数的默认值"></a>指定视图参数的默认值</h3><p>有一个小技巧，我们可以指定视图参数的默认值。 下面是一个URLconf和视图的示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URLconf</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'blog/'</span>, views.page),</span><br><span class="line">    path(<span class="string">'blog/page&lt;int:num&gt;/'</span>, views.page),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># View (in app/views.py)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span><span class="params">(request, num=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="comment"># Output the appropriate page of blog entries, according to num.</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，两个URL模式指向同一个视图<code>views.page</code>。但是第一个模式不会从URL中捕获任何值。 如果第一个模式匹配，<code>page()</code>函数将使用<code>num</code>参数的默认值”1”。 如果第二个模式匹配，<code>page()</code>将使用捕获的num值。</p>
<h3 id="自定义错误页面"><a href="#自定义错误页面" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h3><p>当Django找不到与请求匹配的URL时，或者当抛出一个异常时，将调用一个错误处理视图。Django默认的自带的错误视图包括400、403、404和500，分别表示请求错误、拒绝服务、页面不存在和服务器错误<br>它们分别位于：</p>
<ul>
<li>handler400 —— django.conf.urls.handler400。</li>
<li>handler403 —— django.conf.urls.handler403。</li>
<li>handler404 —— django.conf.urls.handler404。</li>
<li>handler500 —— django.conf.urls.handler500。</li>
</ul>
<p>这些值可以在根URLconf中设置。在其它app中的二级URLconf中设置这些变量无效。</p>
<p>我们可以自定义错误页面<br>首先，在根URLconf中额外增加下面的条目，并导入<code>views</code>模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加的条目</span></span><br><span class="line">handler400 = views.bad_request</span><br><span class="line">handler403 = views.permission_denied</span><br><span class="line">handler404 = views.page_not_found</span><br><span class="line">handler500 = views.error</span><br></pre></td></tr></table></figure>

<p>然后在，app/views.py文件中增加四个处理视图：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bad_request</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'400.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permission_denied</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'403.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'404.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'500.html'</span>)</span><br></pre></td></tr></table></figure>

<p>除了这些，还需要将<code>setting.py</code>中的<code>DEUBG = True</code>改为<code>DEUBG = false</code></p>
<h2 id="路由转发"><a href="#路由转发" class="headerlink" title="路由转发"></a>路由转发</h2><p>通常，我们会在每个app里，各自创建一个<code>urls.py</code>路由模块，然后从根路由出发，将app所属的url请求，全部转发到相应的<code>urls.py</code>模块中。</p>
<p>路由转发使用的是<code>include()</code>方法，需要提前导入，它的参数是转发目的地路径的字符串，路径以圆点<code>&quot;.&quot;</code>分割。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'community/'</span>, include(<span class="string">'aggregator.urls'</span>)),</span><br><span class="line">    path(<span class="string">'contact/'</span>, include(<span class="string">'contact.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>每当Django 遇到<code>include()</code>时，它会去掉URL中匹配的部分并将剩下的字符串发送给<code>include</code>的<code>URLconf</code>做进一步处理，也就是转发到二级路由去</p>
<h2 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h2><p>在URL中提供一个<code>name</code>参数，并赋值一个你自定义的、好记的、直观的字符串。<br>通过这个<code>name</code>参数，可以反向解析URL、反向URL匹配、反向URL查询或者简单的URL反查。</p>
<p>在需要解析URL的地方，对于不同层级，Django提供了不同的工具用于URL反查：</p>
<ul>
<li>在模板语言中：使用<code>url</code>模板标签。(也就是写前端网页时）</li>
<li>在Python代码中：使用<code>reverse()</code>函数。（也就是写视图函数等情况时）</li>
<li>在更高层的与处理Django模型实例相关的代码中：使用<code>get_absolute_url()</code>方法。(也就是在模型model中)</li>
</ul>
<p><strong>例如：</strong></p>
<p>URLconf：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/'</span>, views.year_archive, name=<span class="string">'news-year-archive'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>2019年对应的归档URL是/articles/2019/。</p>
<p>模板的代码中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'news-year-archive' 2012 %&#125;"</span>&gt;</span>2012 Archive<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;# Or with the year in a template context variable: #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% for yearvar in year_list %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'news-year-archive' yearvar %&#125;"</span>&gt;</span>&#123;&#123; yearvar &#125;&#125; Archive<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Python代码中：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redirect_to_year</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    year = <span class="number">2019</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">'news-year-archive'</span>, args=(year,)))</span><br></pre></td></tr></table></figure>

<p>在<code>app</code>中的<code>urls.py</code>中，需要声明此app的名称，使用<code>app_name = &#39;app名字&#39;</code></p>
<p>之后需要反向解析到此<code>urls.py</code>中的路由，需要使用<code>app名字.路由</code>的格式。</p>
<p>比如：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> student <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'student'</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),           <span class="comment"># /student/</span></span><br><span class="line">    path(<span class="string">'info'</span>, views.info, name=<span class="string">'info'</span>),         <span class="comment"># /student/info</span></span><br><span class="line">    path(<span class="string">'export'</span>, views.export, name=<span class="string">'export'</span>),   <span class="comment"># /student/export</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="视图函数"><a href="#视图函数" class="headerlink" title="视图函数"></a>视图函数</h2><p>一个简单的视图</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">current_datetime</span><span class="params">(request)</span>:</span></span><br><span class="line">    now = datetime.datetime.now()</span><br><span class="line">    html = <span class="string">"&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;"</span> % now</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure>

<p>每个视图函数都接收一个<code>HttpRequest</code>对象作为<strong>第一位置参数</strong>，一般取名为<code>request</code><br>该视图返回一个<code>HttpResponse</code>对象，其中包含生成的HTML页面。</p>
<h2 id="Django内置的一些方法"><a href="#Django内置的一些方法" class="headerlink" title="Django内置的一些方法"></a>Django内置的一些方法</h2><p>Django在<code>django.shortcuts</code>模块中，为我们提供了很多快捷方便的类和方法，它们都很重要，使用频率很高</p>
<h3 id="render"><a href="#render" class="headerlink" title="render()"></a>render()</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render(request, template_name, context=<span class="literal">None</span>, content_type=<span class="literal">None</span>, status=<span class="literal">None</span>, using=<span class="literal">None</span>)[source]</span><br></pre></td></tr></table></figure>
<p>结合一个给定的模板和一个给定的上下文字典，返回一个渲染后的<code>HttpResponse</code>对象。<br><strong>必须参数：</strong></p>
<ul>
<li><code>request</code>：视图函数处理的当前请求，封装了请求头的所有数据，其实就是视图参数<code>request</code>。</li>
<li><code>template_name</code>：要使用的模板的完整名称或者模板名称的列表。如果是一个列表，将使用其中能够查找到的第一个模板。</li>
</ul>
<p><strong>可选参数：</strong></p>
<ul>
<li><code>context</code>：添加到模板上下文的一个数据<strong>字典</strong>。默认是一个空字典。可以将认可需要提供给模板的数据以字典的格式添加进去。<br>这里有个小技巧，使用Python内置的<code>locals()</code>方法，可以方便的将函数作用于内的所有变量一次性添加。</li>
<li><code>content_type</code>：用于生成的文档的MIME类型。 默认为<code>DEFAULT_CONTENT_TYPE</code>设置的值。</li>
<li><code>status</code>：响应的状态代码。 默认为200。</li>
<li><code>using</code>：用于加载模板使用的模板引擎的NAME。</li>
</ul>
<p>一个例子：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;</span><br><span class="line">        <span class="string">'foo'</span>: <span class="string">'bar'</span>,</span><br><span class="line">    &#125;, content_type=<span class="string">'application/xhtml+xml'</span>)</span><br></pre></td></tr></table></figure>
<p>这个示例等同于：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    t = loader.get_template(<span class="string">'index.html'</span>)</span><br><span class="line">    c = &#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(t.render(c, request), content_type=<span class="string">'application/xhtml+xml'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="redirect"><a href="#redirect" class="headerlink" title="redirect()"></a>redirect()</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect(to, permanent=<span class="literal">False</span>, args, *kwargs)[source]</span><br></pre></td></tr></table></figure>
<p>根据传递进来的url参数，返回<code>HttpResponseRedirect</code><br>参数to可以是：</p>
<ul>
<li>一个模型：将调用模型的<code>get_absolute_url()</code>函数，反向解析出目的url；</li>
<li>视图名称：可能带有参数：<code>reverse()</code>将用于反向解析url；</li>
<li>一个绝对的或相对的URL：将原封不动的作为重定向的目标位置。</li>
</ul>
<p>默认情况下是临时重定向，如果设置permanent=True将永久重定向。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">传递视图名，使用reverse()方法反向解析url：</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'some-view-name'</span>, foo=<span class="string">'bar'</span>)</span><br><span class="line"></span><br><span class="line">重定向到硬编码的URL：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/some/url/'</span>)</span><br><span class="line"></span><br><span class="line">重定向到一个完整的URL：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'https://example.com/'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="get-object-or-404"><a href="#get-object-or-404" class="headerlink" title="get_object_or_404()"></a>get_object_or_404()</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_object_or_404(klass, args, *kwargs)[source]</span><br></pre></td></tr></table></figure>
<p>常用于查询某个对象，找到了则进行下一步处理，如果未找到则给用户返回404页面。</p>
<p>在后台，Django其实是调用了模型管理器的<code>get()</code>方法，只会返回一个对象。不同的是，如果<code>get()</code>发生异常，会引发<code>Http404</code>异常，从而返回404页面，而不是模型的<code>DoesNotExist</code>异常。</p>
<p>必需参数：</p>
<ul>
<li><code>klass</code>：要获取的对象的<code>Model</code>类名或者<code>Queryset</code>等；</li>
<li><code>**kwargs</code>:查询的参数，格式应该可以被<code>get()</code>接受。</li>
</ul>
<h2 id="HttpRequest对象"><a href="#HttpRequest对象" class="headerlink" title="HttpRequest对象"></a>HttpRequest对象</h2><p>每当一个用户请求发送过来，Django将HTTP数据包中的相关内容，打包成为一个<code>HttpRequest</code>对象，并传递给每个视图函数作为第一位置参数，也就是<code>request</code>，供我们调用。</p>
<h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h3><ol>
<li><p>HttpRequest.scheme<br>字符串类型，表示请求的协议种类，’<code>http</code>‘或’<code>https</code>‘。</p>
</li>
<li><p>HttpRequest.body<br><code>bytes</code>类型，表示原始HTTP请求的正文。它对于处理非HTML形式的数据非常有用：二进制图像、XML等。<br>如果要处理常规的表单数据，应该使用<code>HttpRequest.POST</code>。</p>
</li>
<li><p>HttpRequest.path<br>字符串类型，表示当前请求页面的完整路径，但是不包括协议名和域名。<br>例如：”<code>/music/bands/the_beatles/</code>“。<br>这个属性，常被用于我们进行某项操作时，如果不通过，返回用户先前浏览的页面。非常有用！</p>
</li>
<li><p>HttpRequest.path_info<br>在某些Web服务器配置下，主机名后的URL部分被分成脚本前缀部分和路径信息部分。<code>path_info</code> 属性将始终包含路径信息部分，不论使用的Web服务器是什么。<br>使用它代替path可以让代码在测试和开发环境中更容易地切换。<br><br>例如，如果应用的WSGIScriptAlias设置为<code>/minfo</code>，那么<code>HttpRequest.path</code>等于<code>/music/bands/the_beatles/</code> ，而<code>HttpRequest.path_info</code>为<code>/minfo/music/bands/the_beatles/</code>。</p>
</li>
<li><p>HttpRequest.method<br>字符串类型，表示请求使用的HTTP方法。默认为大写。 像这样：</p>
</li>
<li><p>HttpRequest.encoding<br>字符串类型，表示提交的数据的编码方式（如果为<code>None</code> 则表示使用<code>DEFAULT_CHARSET</code>设置）。<br>这个属性是可写的，可以通过修改它来改变表单数据的编码。任何随后的属性访问（例如GET或POST）将使用新的编码方式。</p>
</li>
<li><p>HttpRequest.content_type<br>表示从<code>CONTENT_TYPE</code>头解析的请求的MIME类型。</p>
</li>
<li><p>HttpRequest.content_params<br>包含在<code>CONTENT_TYPE</code>标题中的键/值参数字典。</p>
</li>
<li><p>HttpRequest.GET<br> 一个类似于字典的对象，包含GET请求中的所有参数。</p>
</li>
<li><p>HttpRequest.POST<br>一个包含所有POST请求的参数，以及包含表单数据的字典。<br>如果需要访问请求中的原始或非表单数据，可以使用<code>HttpRequest.body</code>属性。<br>POST中不包含上传文件的数据。</p>
</li>
<li><p>HttpRequest.COOKIES<br>包含所有Cookie信息的字典。键和值都为字符串。<br>可以类似字典类型的方式，在cookie中读写数据</p>
</li>
<li><p>HttpRequest.FILES<br>一个类似于字典的对象，包含所有上传的文件数据。<br><code>FILES</code>中的每个键为<code>&lt;input type=&quot;file&quot; name=&quot;&quot; /&gt;</code>中的name属性值。<br><code>FILES</code>中的每个值是一个<code>UploadedFile</code>要在Django中实现文件上传，就要靠这个属性！<br>如果请求方法是POST且请求的<code>&lt;form&gt;</code>中带有<code>enctype=&quot;multipart/form-data&quot;</code>属性，那么<code>FILES</code>将包含上传的文件的数据。 否则，<code>FILES</code>将为一个空的类似于字典的对象，属于被忽略、无用的情形。</p>
</li>
<li><p>HttpRequest.META<br>包含所有HTTP头部信息的字典。 可用的头部信息取决于客户端和服务器，下面是一些示例：<br><code>CONTENT_LENGTH</code> —— 请求正文的长度（以字符串计）。<br><code>CONTENT_TYPE</code> —— 请求正文的MIME类型。<br><code>HTTP_ACCEPT</code> —— 可接收的响应Content-Type。<br><code>HTTP_ACCEPT_ENCODING</code> —— 可接收的响应编码类型。<br><code>HTTP_ACCEPT_LANGUAGE</code> —— 可接收的响应语言种类。<br><code>HTTP_HOST</code> —— 客服端发送的Host头部。<br><code>HTTP_REFERER</code> —— Referring页面。<br><code>HTTP_USER_AGENT</code> —— 客户端的user-agent字符串。<br><code>QUERY_STRING</code> —— 查询字符串。<br><code>REMOTE_ADDR</code> —— 客户端的IP地址。想要获取客户端的ip信息，就在这里！<br><code>REMOTE_HOST</code> —— 客户端的主机名。<br><code>REMOTE_USER</code> —— 服务器认证后的用户，如果可用。<br><code>REQUEST_METHOD</code> —— 表示请求方法的字符串，例如”GET” 或”POST”。<br><code>SERVER_NAME</code> —— 服务器的主机名。<br><code>SERVER_PORT</code> —— 服务器的端口（字符串）。<br><br>除<code>CONTENT_LENGTH</code>和<code>CONTENT_TYPE</code>之外，请求中的任何HTTP头部键转换为<code>META</code>键时，都会<strong>将所有字母大写并将连接符替换为下划线最后加上HTTP_前缀</strong>。</p>
</li>
</ol>
<h2 id="QueryDict对象"><a href="#QueryDict对象" class="headerlink" title="QueryDict对象"></a>QueryDict对象</h2><p>在<code>HttpRequest</code>对象中，<code>GET</code>和<code>POST</code>属性都是一个<code>django.http.QueryDict</code>的实例</p>
<p><code>request.POST</code>或<code>request.GET</code>的<code>QueryDict</code>都是不可变，只读的。如果要修改它，需要使用<code>QueryDict.copy()</code>方法，获取它的一个拷贝，然后在这个拷贝上进行修改操作。</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><h2 id="django-sessioin"><a href="#django-sessioin" class="headerlink" title="django sessioin"></a>django sessioin</h2><h3 id="启用session"><a href="#启用session" class="headerlink" title="启用session"></a>启用session</h3><p>编辑<code>settings.py</code>中的一些配置</p>
<p><code>MIDDLEWARE</code> 确保其中包含以下内容<br><code>&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</code></p>
<p><code>INSTALLED_APPS</code> 是包含<code>&#39;django.contrib.sessions&#39;</code><br>这些是默认启用的。如果你不用的话，也可以关掉这个以节省一点服务器的开销。</p>
<h3 id="sessioin的配置"><a href="#sessioin的配置" class="headerlink" title="sessioin的配置"></a>sessioin的配置</h3><p>使用数据库+缓存的session<br>配置<code>settings.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cached_db'</span> <span class="comment"># 引擎</span></span><br><span class="line">SESSION_COOKIE_NAME = <span class="string">'sessionid'</span>      <span class="comment"># sesion的cookie保存在浏览器时的key</span></span><br></pre></td></tr></table></figure>

<h3 id="session的基本操作"><a href="#session的基本操作" class="headerlink" title="session的基本操作"></a>session的基本操作</h3><p><strong>以键值对的格式写session</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.session[<span class="string">'键'</span>]=值</span><br></pre></td></tr></table></figure>

<p><strong>根据键读取值</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.session.get(<span class="string">'键'</span>,默认值)</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">request.session[<span class="string">'键'</span>]</span><br></pre></td></tr></table></figure>

<p><strong>清除所有session，在存储中删除值的部分</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.session.clear()</span><br></pre></td></tr></table></figure>

<p><strong>清除session数据，在存储中删除session的整条数据</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.session.flush()</span><br></pre></td></tr></table></figure>

<p><strong>删除session中的指定键及值，在存储中只删除某个键及对应的值</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> request.session[<span class="string">'键'</span>]</span><br></pre></td></tr></table></figure>

<p><strong>设置session数据有效时间； 如果不设置，默认过期时间为两周</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.session.set_expiry(value)</span><br></pre></td></tr></table></figure>
<p>如果过期时间的<code>value</code>是一个整数，则 session 数据 将在<code>value</code>秒没有活动后过期。<br>如果过期时间的<code>value</code>为<code>None</code>，那么会话永不过期。<br>如果过期时间的<code>value</code>为0，那么用户会话的Cookie将在用户的浏览器关闭时过期。</p>
<h2 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h2><p>Django中提供了一种解析的方式配置静态文件路径。静态文件可以放在项目根目录下，也可以放在应用的目录下，由于有些静态文件在项目中是通用的，所以推荐放在项目的根目录下，方便管理。</p>
<p>在<code>setting.py</code>中定义静态文件存放的物理目录</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">'static'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这样，就设置了静态文件的存储路径为<code>/static</code></p>
<p>在模板中，我们首先需要使用<code>{%  load static %}</code>加载 Django 的 <code>STATICFILES_STORAGE</code>，之后使用<code>{% static "images/a.jpg" %}</code>来动态的获取静态文件，而不是写死的路径。</p>
<h1 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h1><p>默认配置下，Django 的模板系统会自动找到app下面的<code>templates</code>文件夹中的模板文件。<br>变量：<code>{{ }}</code><br>功能类的:<code>{% %}</code></p>
<p>获取字典内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user = &#123;<span class="string">'name'</span>:<span class="string">'admin'</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;dict_user.name&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在模板中取字典的键是用点<code>user.name</code>，而不是Python中的 <code>user[&#39;name&#39;]</code></p>
<h2 id="循环for，条件判断if"><a href="#循环for，条件判断if" class="headerlink" title="循环for，条件判断if"></a>循环for，条件判断if</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for i in list %&#125;</span><br><span class="line">    &#123;&#123; i &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>for循环有一些属性：<br><code>forloop.counter</code>    索引从 1 开始算<br><code>forloop.counter0</code>    索引从 0 开始算<br><code>forloop.revcounter</code>    索引从最大长度到 1<br><code>forloop.revcounter0</code>    索引从最大长度到 0<br><code>forloop.first</code>    当遍历的元素为第一项时为真<br><code>forloop.last</code>    当遍历的元素为最后一项时为真<br><code>forloop.parentloop</code>     用在嵌套的 <code>for</code> 循环中，获取上一层 <code>for</code> 循环的 <code>forloop</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for item in List %&#125;</span><br><span class="line">    &#123;&#123; item &#125;&#125;&#123;% if not forloop.last %&#125;,&#123;% endif %&#125; </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>列表中可能为空时，用<code>for empty</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% for athlete in athlete_list %&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123; athlete.name &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line">    &lt;li&gt;抱歉，列表为空&lt;&#x2F;li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Dar1in9</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://dar1in9s.github.io/2020/06/12/django/">http://dar1in9s.github.io/2020/06/12/django/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Dar1in9s.github.io">Dar1in9's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/django/">django</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/07/31/sql%E6%B3%A8%E5%85%A5%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"><i class="fa fa-chevron-left">  </i><span>sql注入中常用的函数</span></a></div><div class="next-post pull-right"><a href="/2020/05/19/express%E9%85%8D%E7%BD%AEredis%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8session%E4%BC%9A%E8%AF%9D/"><span>express配置redis持久化存储session</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://blog-1300147235.cos.ap-chengdu.myqcloud.com/Background2.png)"><div class="layout" id="footer"><div class="copyright">&copy;2020 By Dar1in9</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>